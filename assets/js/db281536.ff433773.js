"use strict";(self.webpackChunkncm_301_2=self.webpackChunkncm_301_2||[]).push([[6306],{7510:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>i,metadata:()=>a,toc:()=>d});var r=s(4848),t=s(8453);const i={},l="Calm: Onboard Tenant",a={id:"calm_onboard_tenant/calm_onboard_tenant",title:"calm_onboard_tenant",description:"Script Provided Below.. \\calmdsl:",source:"@site/docs/calm_onboard_tenant/calm_onboard_tenant.mdx",sourceDirName:"calm_onboard_tenant",slug:"/calm_onboard_tenant/",permalink:"/ncm301-2/docs/calm_onboard_tenant/",draft:!1,unlisted:!1,editUrl:"https://github.com/mat0606/ncm301-2/edit/main/docs/calm_onboard_tenant/calm_onboard_tenant.mdx",tags:[],version:"current",frontMatter:{}},c={},d=[{value:"Pre-requsities:",id:"pre-requsities",level:2},{value:"Overview",id:"overview",level:2},{value:"Create a blueprint to onboard tenant",id:"create-a-blueprint-to-onboard-tenant",level:3},{value:"Create a blueprint to create subnet into VPC",id:"create-a-blueprint-to-create-subnet-into-vpc",level:3},{value:"Create a blueprint to create Tunnel VM into VPC",id:"create-a-blueprint-to-create-tunnel-vm-into-vpc",level:3}];function o(n){const e={blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.em,{children:"Script Provided Below"}),".. _calm_dsl:"]}),"\n",(0,r.jsx)(e.h1,{id:"calm-onboard-tenant",children:"Calm: Onboard Tenant"}),"\n",(0,r.jsx)(e.h2,{id:"pre-requsities",children:"Pre-requsities:"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:"In Prism Central, Micro-service infrastructure was enabled"}),"\n",(0,r.jsx)(e.li,{children:"In Prism Central, Advanced Network was enabled"}),"\n",(0,r.jsx)(e.li,{children:"PC2022.1.02"}),"\n",(0,r.jsx)(e.li,{children:"Calm 3.5.0"}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(e.p,{children:"The service provider would like to onboard each tenant."}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(5664).A+"",width:"1909",height:"859"})}),"\n",(0,r.jsx)(e.h3,{id:"create-a-blueprint-to-onboard-tenant",children:"Create a blueprint to onboard tenant"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["Click on ",(0,r.jsx)(e.strong,{children:"Create Blueprint"}),". Create a ",(0,r.jsx)(e.strong,{children:"Multi VM/Pod"})," blueprint."]}),"\n"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(6413).A+"",width:"529",height:"206"})}),"\n"]}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["Select the ",(0,r.jsx)(e.strong,{children:"Credentials"})," tab. Create a new credential for ",(0,r.jsx)(e.strong,{children:"PC\nCredential"})," and enter desired User/Pass**"]}),"\n"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(5769).A+"",width:"796",height:"546"})}),"\n"]}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:"Create the following variables on the right side of the screen."}),"\n"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["vpc_name Default value: empty. ",(0,r.jsx)(e.strong,{children:"Mark this variable mandatory"})]}),"\n",(0,r.jsxs)(e.li,{children:["external_routable_ip Default value: ",(0,r.jsx)(e.strong,{children:"Follow the cluster. Eg\n10.x.x.0/24"}),". ",(0,r.jsx)(e.strong,{children:"Mark this variable mandatory"})]}),"\n",(0,r.jsxs)(e.li,{children:["dns Default value: ",(0,r.jsx)(e.strong,{children:"1.1.1.1"}),". ",(0,r.jsx)(e.strong,{children:"Mark this variable mandatory"})]}),"\n",(0,r.jsxs)(e.li,{children:["PC_IP Default value: ",(0,r.jsx)(e.strong,{children:"Follow the cluster PC. Eg 10.x.x.39"})]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(6212).A+"",width:"476",height:"498"})}),"\n"]}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["Create the following dynamic variable: ",(0,r.jsx)(e.strong,{children:"external_subnet"})," on the\nright side of the screen. ",(0,r.jsx)(e.strong,{children:"Replace the password with the Prism\nCentral password."})]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'user = "admin"\npassword = "x.x.x.x"\nip = "@@{PC_IP}@@"\npayload = {\n"kind": "subnet"\n}\nbase_url = "https://" + ip + ":9440/api/nutanix/v3/subnets"\nurl = base_url + "/list"\nheaders = {\'Accept\': \'application/json\', \'Content-Type\': \'application/json\'}\nurl_method = "POST"\nr = urlreq(url, url_method, auth="BASIC", user=user, passwd=password, params=json.dumps(payload), verify=False, headers=headers)\nsubnet_list = []\nsubnet_list_json = r.json()\nfor subnet in subnet_list_json[\'entities\']:\n  subnet_list.append("{}".format(subnet[\'spec\'][\'name\']))\n  print \',\'.join(subnet_list)\n'})}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["On the left hand side of the screen, create a service action:\n",(0,r.jsx)(e.strong,{children:"Create VPC"})]}),"\n"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(670).A+"",width:"551",height:"293"})}),"\n"]}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["On the service, click ",(0,r.jsx)(e.strong,{children:"Create Task"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["Task Name: ",(0,r.jsx)(e.strong,{children:"GetNetworkUUID"})]}),"\n",(0,r.jsxs)(e.li,{children:["Type: ",(0,r.jsx)(e.strong,{children:"Set Variable"})]}),"\n",(0,r.jsxs)(e.li,{children:["Script Type: ",(0,r.jsx)(e.strong,{children:"EScript"})]}),"\n",(0,r.jsxs)(e.li,{children:["output: ",(0,r.jsx)(e.strong,{children:"pe_network_UUID"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'user = "@@{PC Credential.username}@@"\npassword = "@@{PC Credential.secret}@@"\nip = "@@{PC_IP}@@"\n\npayload = {\n\n}\n\nbase_url = "https://" + ip + ":9440/api/nutanix/v3/subnets"\nurl = base_url + "/list"\nheaders = {\'Accept\': \'application/json\', \'Content-Type\': \'application/json\'}\nurl_method = "POST"\nr = urlreq(url, url_method, auth="BASIC", user=user, passwd=password, params=json.dumps(payload), verify=False, headers=headers)\nsubnet_list = []\nsubnet_list_json = r.json()\nfor subnet in subnet_list_json[\'entities\']:\n  if subnet[\'spec\'][\'name\'] == "@@{external_subnet}@@":\n    print "pe_network_UUID={}".format(subnet[\'metadata\'][\'uuid\'])\n    exit(0)\nexit(1)\n'})}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["On the service, click ",(0,r.jsx)(e.strong,{children:"Create Task"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["Task Name: ",(0,r.jsx)(e.strong,{children:"Split external routable ip"})]}),"\n",(0,r.jsxs)(e.li,{children:["Type: ",(0,r.jsx)(e.strong,{children:"Set Variable"})]}),"\n",(0,r.jsxs)(e.li,{children:["Script Type: ",(0,r.jsx)(e.strong,{children:"EScript"})]}),"\n",(0,r.jsxs)(e.li,{children:["output: ",(0,r.jsx)(e.strong,{children:"ext_routable_ip"})]}),"\n",(0,r.jsxs)(e.li,{children:["output: ",(0,r.jsx)(e.strong,{children:"ext_routable_ip_prefix"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'ext_routable_ip = "@@{external_routable_ip}@@"\n\next_routable_ip_array = [] \next_routable_ip_array = ext_routable_ip.split("/")\nprint "ext_routable_ip={0}".format(ext_routable_ip_array[0])\nprint "ext_routable_ip_prefix={0}".format(ext_routable_ip_array[1])\n'})}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["On the service, click ",(0,r.jsx)(e.strong,{children:"Create Task"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["Task Name: ",(0,r.jsx)(e.strong,{children:"Invoke API to create VPC"})]}),"\n",(0,r.jsxs)(e.li,{children:["Type: ",(0,r.jsx)(e.strong,{children:"Execute"})]}),"\n",(0,r.jsxs)(e.li,{children:["Script Type: ",(0,r.jsx)(e.strong,{children:"EScript"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'user = "@@{PC_Credential.username}@@"\npassword = "@@{PC_Credential.secret}@@"\nip = "@@{PC_IP}@@"\n\n\npayload = {\n  "spec": {\n    "name": "@@{vpc_name}@@",\n    "resources": {\n      "common_domain_name_server_ip_list": [\n      { \n        "ip": "@@{dns}@@"\n      }\n      ],\n      "external_subnet_list": [\n      {\n        "external_subnet_reference": {\n          "kind": "subnet",\n          "uuid": "@@{pe_network_UUID}@@"\n        }\n      }\n      ],\n      "externally_routable_prefix_list": [\n      {\n        "ip": "@@{ext_routable_ip}@@",\n        "prefix_length": @@{ext_routable_ip_prefix}@@\n      }\n      ]\n    }\n  },\n#  "description": "on prem VPC",\n  "api_version": "3.0",\n  "metadata": {\n    "kind": "vpc",\n    "categories": {\n      "VirtualNetworkType": "Tenant"\n    }\n  }\n}\n\nurl = "https://" + ip + ":9440/api/nutanix/v3/vpcs"\nheaders = {\'Accept\': \'application/json\', \'Content-Type\': \'application/json\'}\nurl_method = "POST"\nr = urlreq(url, url_method, auth="BASIC", user=user, passwd=password, params=json.dumps(payload), verify=False, headers=headers)\nprint "Status code: {}".format(r.status_code)\nprint "Output: {}".format(r.text)\nif r.ok:\n  print "VPC {0} is created successfully".format("@@{vpc_name}@@")\nelse:\n  exit(1)\n'})}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["On the left side of the screen, click on ",(0,r.jsx)(e.strong,{children:"Package: Install"})]}),"\n"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(9061).A+"",width:"1026",height:"272"})}),"\n"]}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["Click on ",(0,r.jsx)(e.strong,{children:"+ Action"})]}),"\n"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(2440).A+"",width:"489",height:"423"})}),"\n"]}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["Let's create the service action to delete the VPC. On the left hand\nside of the screen, create a service action: ",(0,r.jsx)(e.strong,{children:"Delete VPC"})]}),"\n"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(670).A+"",width:"551",height:"293"})}),"\n"]}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["On the service, click ",(0,r.jsx)(e.strong,{children:"Create Task"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["Task Name: ",(0,r.jsx)(e.strong,{children:"Get VPC UUID"})]}),"\n",(0,r.jsxs)(e.li,{children:["Type: ",(0,r.jsx)(e.strong,{children:"Set Variable"})]}),"\n",(0,r.jsxs)(e.li,{children:["Script Type: ",(0,r.jsx)(e.strong,{children:"EScript"})]}),"\n",(0,r.jsxs)(e.li,{children:["output: ",(0,r.jsx)(e.strong,{children:"vpc_uuid"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'user = "@@{PC Credential.username}@@"\npassword = "@@{PC Credential.secret}@@"\nip = "@@{PC_IP}@@"\n\npayload = {}\n\nbase_url = "https://" + ip + ":9440/api/nutanix/v3/vpcs"\nurl = base_url + "/list"\nheaders = {\'Accept\': \'application/json\', \'Content-Type\': \'application/json\'}\nurl_method = "POST"\nr = urlreq(url, url_method, auth="BASIC", user=user, passwd=password, params=json.dumps(payload), verify=False, headers=headers)\n#print "Status code: {}".format(r.status_code)\n#print "Output: {}".format(r.text)\nvpc_list = []\nvpc_list_json = r.json()\nfor vpc in vpc_list_json[\'entities\']:\n  if vpc[\'spec\'][\'name\'] == "@@{vpc_name}@@":\n    print vpc[\'spec\'][\'name\']\n    print "vpc_uuid={0}".format(vpc[\'metadata\'][\'uuid\'])\n    exit(0)\nexit(1)  \n'})}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["On the service, click ",(0,r.jsx)(e.strong,{children:"Create Task"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["Task Name: ",(0,r.jsx)(e.strong,{children:"Invoke API to delete VPC"})]}),"\n",(0,r.jsxs)(e.li,{children:["Type: ",(0,r.jsx)(e.strong,{children:"Execute"})]}),"\n",(0,r.jsxs)(e.li,{children:["Script Type: ",(0,r.jsx)(e.strong,{children:"EScript"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'user = "@@{PC Credential.username}@@"\npassword = "@@{PC Credential.secret}@@"\nip = "@@{PC_IP}@@"\n\npayload = {\n\n}\n\nurl = "https://" + ip + ":9440/api/nutanix/v3/vpcs/@@{vpc_uuid}@@"\nheaders = {\'Accept\': \'application/json\', \'Content-Type\': \'application/json\'}\nurl_method = "DELETE"\nr = urlreq(url, url_method, auth="BASIC", user=user, passwd=password, params=json.dumps(payload), verify=False, headers=headers)\nprint "Status code: {}".format(r.status_code)\n#print "Output: {}".format(r.text)\nif r.ok:\n  print "VPC {0} is created successfully".format("@@{vpc_name}@@")\nelse:\n  exit(1)\n'})}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["Associate the ",(0,r.jsx)(e.strong,{children:"Delete VPC"})," action with the ",(0,r.jsx)(e.strong,{children:"Package uninstall"}),"\naction. Click on ",(0,r.jsx)(e.strong,{children:"+ Action"}),". Choose the ",(0,r.jsx)(e.strong,{children:"Delete VPC"})," action."]}),"\n"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(832).A+"",width:"1002",height:"306"})}),"\n"]}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:'Enter the name of Application "VPC-<INITIALS> and fill out the\nform with the requested information'}),"\n"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(2881).A+"",width:"624",height:"420"})}),"\n"]}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["Press ",(0,r.jsx)(e.strong,{children:"Deploy"})]}),"\n",(0,r.jsx)(e.li,{children:'Once the application is "running". Let\'s look at the audit log.'}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(2701).A+"",width:"475",height:"491"})}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["In Prism Central ",(0,r.jsx)(e.strong,{children:"Network and Security"})," ",(0,r.jsx)(e.strong,{children:"Virtual Private Cloud"}),",\nlet's look at the newly created VPC"]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(7507).A+"",width:"624",height:"162"})}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:"Drill into the VPC to look at its details"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(9706).A+"",width:"624",height:"190"})}),"\n",(0,r.jsx)(e.h3,{id:"create-a-blueprint-to-create-subnet-into-vpc",children:"Create a blueprint to create subnet into VPC"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["Click on ",(0,r.jsx)(e.strong,{children:"Create Blueprint"}),". Create a ",(0,r.jsx)(e.strong,{children:"Multi VM/Pod"})," blueprint."]}),"\n"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(6413).A+"",width:"529",height:"206"})}),"\n"]}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["Select the ",(0,r.jsx)(e.strong,{children:"Credentials"})," tab. Create a new credential for ",(0,r.jsx)(e.strong,{children:"PC\nCredential"})," and enter desired User/Pass**"]}),"\n"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(5769).A+"",width:"796",height:"546"})}),"\n"]}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:"Create the following variables on the right side of the screen."}),"\n"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["subnet_name Default value: empty. ",(0,r.jsx)(e.strong,{children:"Mark this variable mandatory"})]}),"\n",(0,r.jsxs)(e.li,{children:["Gateway_IP Default value: ",(0,r.jsx)(e.strong,{children:"192.168.1.1"}),". ",(0,r.jsx)(e.strong,{children:"Mark this variable\nmandatory"})]}),"\n",(0,r.jsxs)(e.li,{children:["Network_IP_Prefix Default value: ",(0,r.jsx)(e.strong,{children:"192.168.1.0/24"}),". ",(0,r.jsx)(e.strong,{children:"Mark this\nvariable mandatory"})]}),"\n",(0,r.jsxs)(e.li,{children:["Start_IP Default value: ",(0,r.jsx)(e.strong,{children:"192.168.1.10"}),". ",(0,r.jsx)(e.strong,{children:"Mark this variable\nmandatory"})]}),"\n",(0,r.jsxs)(e.li,{children:["End_IP Default value: ",(0,r.jsx)(e.strong,{children:"192.168.1.30"}),". ",(0,r.jsx)(e.strong,{children:"Mark this variable\nmandatory"})]}),"\n",(0,r.jsxs)(e.li,{children:["PC_IP Default value: ",(0,r.jsx)(e.strong,{children:"Follow the cluster PC. Eg 10.x.x.39"})]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(172).A+"",width:"472",height:"671"})}),"\n"]}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["Create the following dynamic variable: ",(0,r.jsx)(e.strong,{children:"vpc_name"})," on the right\nside of the screen. ",(0,r.jsx)(e.strong,{children:"Replace the password with the Prism Central\npassword."})]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'user = "admin"\npassword = "xxxxxxxx"\nip = "@@{PC_IP}@@"\npayload = {}\nbase_url = "https://" + ip + ":9440/api/nutanix/v3/vpcs"\nurl = base_url + "/list"\nheaders = {\'Accept\': \'application/json\', \'Content-Type\': \'application/json\'}\nurl_method = "POST"\nr = urlreq(url, url_method, auth="BASIC", user=user, passwd=password, params=json.dumps(payload), verify=False, headers=headers)\n#print "Status code: {}".format(r.status_code)\n#print "Output: {}".format(r.text)\nvpc_list = []\nvpc_list_json = r.json()\nfor vpc in vpc_list_json[\'entities\']:\n  vpc_list.append("{}".format(vpc[\'spec\'][\'name\']))\nprint \',\'.join(vpc_list)\n'})}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["On the left hand side of the screen, create a service action:\n",(0,r.jsx)(e.strong,{children:"Create Subnet in VPC"})]}),"\n"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(670).A+"",width:"551",height:"293"})}),"\n"]}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["On the service, click ",(0,r.jsx)(e.strong,{children:"Create Task"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["Task Name: ",(0,r.jsx)(e.strong,{children:"Get VPC UUID"})]}),"\n",(0,r.jsxs)(e.li,{children:["Type: ",(0,r.jsx)(e.strong,{children:"Set Variable"})]}),"\n",(0,r.jsxs)(e.li,{children:["Script Type: ",(0,r.jsx)(e.strong,{children:"EScript"})]}),"\n",(0,r.jsxs)(e.li,{children:["output: ",(0,r.jsx)(e.strong,{children:"vpc_uuid"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'user = "@@{PC Credential.username}@@"\npassword = "@@{PC Credential.secret}@@"\nip = "@@{PC_IP}@@"\npayload = {\n  "filter": "name==@@{vpc_name}@@"\n}\nbase_url = "https://" + ip + ":9440/api/nutanix/v3/vpcs"\nurl = base_url + "/list"\nheaders = {\'Accept\': \'application/json\', \'Content-Type\': \'application/json\'}\nurl_method = "POST"\nr = urlreq(url, url_method, auth="BASIC", user=user, passwd=password, params=json.dumps(payload), verify=False, headers=headers)\n#print "Status code: {}".format(r.status_code)\n#print "Output: {}".format(r.text)\nvpc_list = []\nvpc_list_json = r.json()\nfor vpc in vpc_list_json[\'entities\']:\n  print "vpc_uuid={0}".format(vpc[\'metadata\'][\'uuid\'])\n  exit(0)\nprint "Error retrieving the VPC UUID for {0}".format("@@{vpc_name}@@")\nexit(1)\n'})}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["On the service, click ",(0,r.jsx)(e.strong,{children:"Create Task"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["Task Name: ",(0,r.jsx)(e.strong,{children:"Split Network IP Prefix"})]}),"\n",(0,r.jsxs)(e.li,{children:["Type: ",(0,r.jsx)(e.strong,{children:"Set Variable"})]}),"\n",(0,r.jsxs)(e.li,{children:["Script Type: ",(0,r.jsx)(e.strong,{children:"EScript"})]}),"\n",(0,r.jsxs)(e.li,{children:["output: ",(0,r.jsx)(e.strong,{children:"network_ip"})]}),"\n",(0,r.jsxs)(e.li,{children:["output: ",(0,r.jsx)(e.strong,{children:"network_ip_prefix"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'network_ip_prefix = "@@{Network_IP_Prefix}@@"\n\nnetwork_ip_prefix_array = [] \nnetwork_ip_prefix_array = network_ip_prefix.split("/")\nprint "network_ip={0}".format(network_ip_prefix_array[0])\nprint "network_ip_prefix={0}".format(network_ip_prefix_array[1])\n'})}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["On the service, click ",(0,r.jsx)(e.strong,{children:"Create Task"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["Task Name: ",(0,r.jsx)(e.strong,{children:"Create Subnet in VPC"})]}),"\n",(0,r.jsxs)(e.li,{children:["Type: ",(0,r.jsx)(e.strong,{children:"Execute"})]}),"\n",(0,r.jsxs)(e.li,{children:["Script Type: ",(0,r.jsx)(e.strong,{children:"EScript"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'user = "@@{PC Credential.username}@@"\npassword = "@@{PC Credential.secret}@@"\nip = "@@{PC_IP}@@"\n\n\npayload = {\n  "spec": {\n    "name": "@@{subnet_name}@@",\n    "resources": {\n      "subnet_type": "OVERLAY",\n      "vpc_reference": {\n        "kind": "vpc",\n        "uuid": "@@{vpc_uuid}@@"\n      },\n      "external_connectivity_state": "ENABLED",\n      "ip_config": {\n        "pool_list": [\n        {\n          "range": "@@{Start_IP}@@ @@{End_IP}@@"\n        }\n        ],\n        "subnet_ip": "@@{network_ip}@@",\n        "prefix_length": @@{network_ip_prefix}@@,\n        "default_gateway_ip": "@@{Gateway_IP}@@"\n      }\n    }\n  },\n  "metadata": {\n    "kind": "subnet",\n  }\n}\n\nurl = "https://" + ip + ":9440/api/nutanix/v3/subnets"\nheaders = {\'Accept\': \'application/json\', \'Content-Type\': \'application/json\'}\nurl_method = "POST"\nr = urlreq(url, url_method, auth="BASIC", user=user, passwd=password, params=json.dumps(payload), verify=False, headers=headers)\nprint "Status code: {}".format(r.status_code)\nprint "Output: {}".format(r.text)\nif r.ok:\n  print "Subnet {1} in VPC {0} is created successfully".format("@@{vpc_name}@@","@@{subnet_Name}@@")\nelse:\n  exit(1)\n'})}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["On the left side of the screen, click on ",(0,r.jsx)(e.strong,{children:"Package: Install"})]}),"\n"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(9061).A+"",width:"1026",height:"272"})}),"\n"]}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["Click on ",(0,r.jsx)(e.strong,{children:"+ Action"}),". Associate it with ",(0,r.jsx)(e.strong,{children:"Create Subnet in VPC"})]}),"\n",(0,r.jsxs)(e.li,{children:["Let's create the service action to delete the subnet VPC. On the\nleft hand side of the screen, create a service action: ",(0,r.jsx)(e.strong,{children:"Delete\nSubnet in VPC"})]}),"\n"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(670).A+"",width:"551",height:"293"})}),"\n"]}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["On the service, click ",(0,r.jsx)(e.strong,{children:"Create Task"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["Task Name: ",(0,r.jsx)(e.strong,{children:"Get Subnet UUID"})]}),"\n",(0,r.jsxs)(e.li,{children:["Type: ",(0,r.jsx)(e.strong,{children:"Set Variable"})]}),"\n",(0,r.jsxs)(e.li,{children:["Script Type: ",(0,r.jsx)(e.strong,{children:"EScript"})]}),"\n",(0,r.jsxs)(e.li,{children:["output: ",(0,r.jsx)(e.strong,{children:"subnet_uuid"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'user = "@@{PC Credential.username}@@"\npassword = "@@{PC Credential.secret}@@"\nip = "@@{PC_IP}@@"\npayload = {\n  "filter": "name==@@{subnet_name}@@"\n}\nbase_url = "https://" + ip + ":9440/api/nutanix/v3/subnets"\nurl = base_url + "/list"\nheaders = {\'Accept\': \'application/json\', \'Content-Type\': \'application/json\'}\nurl_method = "POST"\nr = urlreq(url, url_method, auth="BASIC", user=user, passwd=password, params=json.dumps(payload), verify=False, headers=headers)\nsubnet_list = []\nsubnet_list_json = r.json()\nfor subnet in subnet_list_json[\'entities\']:\n  print "subnet_uuid={0}".format(subnet[\'metadata\'][\'uuid\'])\n  exit(0)\nprint "Error retrieving the Subnet UUID for {0}".format("@@{subnet_name}@@")\nexit(1)\n'})}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["On the service, click ",(0,r.jsx)(e.strong,{children:"Create Task"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["Task Name: ",(0,r.jsx)(e.strong,{children:"Delete Subnet"})]}),"\n",(0,r.jsxs)(e.li,{children:["Type: ",(0,r.jsx)(e.strong,{children:"Execute"})]}),"\n",(0,r.jsxs)(e.li,{children:["Script Type: ",(0,r.jsx)(e.strong,{children:"EScript"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'user = "@@{PC Credential.username}@@"\npassword = "@@{PC Credential.secret}@@"\nip = "@@{PC_IP}@@"\n\npayload = {\n}\nbase_url = "https://" + ip + ":9440/api/nutanix/v3/subnets"\nurl = base_url + "/@@{subnet_uuid}@@"\nheaders = {\'Accept\': \'application/json\', \'Content-Type\': \'application/json\'}\nurl_method = "DELETE"\nr = urlreq(url, url_method, auth="BASIC", user=user, passwd=password, params=json.dumps(payload), verify=False, headers=headers)\nprint "Status code: {}".format(r.status_code)\n'})}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["Associate the ",(0,r.jsx)(e.strong,{children:"Delete Subnet in VPC"})," action with the ",(0,r.jsx)(e.strong,{children:"Package\nuninstall"})," action. Click on ",(0,r.jsx)(e.strong,{children:"+ Action"}),". Choose the ",(0,r.jsx)(e.strong,{children:"Delete\nSubnet in VPC"})," action."]}),"\n"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:'Enter the name of Application "SubnetVPC-<INITIALS> and fill\nout the form with the requested information'}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(6318).A+"",width:"624",height:"447"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["Press ",(0,r.jsx)(e.strong,{children:"Deploy"})]}),"\n",(0,r.jsx)(e.li,{children:'Once the application is "running". Let\'s look at the audit log.'}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(3697).A+"",width:"489",height:"415"})}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["In Prism Central ",(0,r.jsx)(e.strong,{children:"Network and Security"})," ",(0,r.jsx)(e.strong,{children:"Virtual Private Cloud"}),",\nlet's look at the newly created VPC"]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(5587).A+"",width:"624",height:"133"})}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:"Drill into the subnet to look at its details"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(7634).A+"",width:"624",height:"174"})}),"\n",(0,r.jsx)(e.h3,{id:"create-a-blueprint-to-create-tunnel-vm-into-vpc",children:"Create a blueprint to create Tunnel VM into VPC"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["Click on ",(0,r.jsx)(e.strong,{children:"Create Blueprint"}),". Create a ",(0,r.jsx)(e.strong,{children:"Multi VM/Pod"})," blueprint."]}),"\n"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(6413).A+"",width:"529",height:"206"})}),"\n"]}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["Select the ",(0,r.jsx)(e.strong,{children:"Credentials"})," tab. Create a new credential for ",(0,r.jsx)(e.strong,{children:"PC\nCredential"})," and enter desired User/Pass**"]}),"\n"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(5769).A+"",width:"796",height:"546"})}),"\n"]}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["Create a new credential for ",(0,r.jsx)(e.strong,{children:"PE Credential"})," and enter desired\nUser/Pass**"]}),"\n",(0,r.jsx)(e.li,{children:"Create the following variables on the right side of the screen."}),"\n"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["PC_IP Default value: ",(0,r.jsx)(e.strong,{children:"Follow the cluster PC. Eg 10.x.x.39"})]}),"\n",(0,r.jsxs)(e.li,{children:["PE_IP Default value: ",(0,r.jsx)(e.strong,{children:"Follow the cluster PE. Eg 10.x.x.37"})]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(4035).A+"",width:"473",height:"400"})}),"\n"]}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["Create the following dynamic variable: ",(0,r.jsx)(e.strong,{children:"vpc_name"})," on the right\nside of the screen. ",(0,r.jsx)(e.strong,{children:"Replace the password with the Prism Central\npassword."})]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'user = "admin"\npassword = "xxxxxxxx"\nip = "@@{PC_IP}@@"\npayload = {}\nbase_url = "https://" + ip + ":9440/api/nutanix/v3/vpcs"\nurl = base_url + "/list"\nheaders = {\'Accept\': \'application/json\', \'Content-Type\': \'application/json\'}\nurl_method = "POST"\nr = urlreq(url, url_method, auth="BASIC", user=user, passwd=password, params=json.dumps(payload), verify=False, headers=headers)\n#print "Status code: {}".format(r.status_code)\n#print "Output: {}".format(r.text)\nvpc_list = []\nvpc_list_json = r.json()\nfor vpc in vpc_list_json[\'entities\']:\n  vpc_list.append("{}".format(vpc[\'spec\'][\'name\']))\nprint \',\'.join(vpc_list)\n'})}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["Create the following dynamic variable: ",(0,r.jsx)(e.strong,{children:"subnet_name"})," on the right\nside of the screen. ",(0,r.jsx)(e.strong,{children:"Replace the password with the Prism Central\npassword."})]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'user = "admin"\npassword = "xxxxxxx"\nip = "@@{PC_IP}@@"\n\nheaders = {\'Accept\': \'application/json\', \'Content-Type\': \'application/json\'}\nurl_method = "POST"\n\ndef get_vpc_uuid(vpc_name):\n    vpc_url = "https://"+ip+":9440/api/nutanix/v3/vpcs/list"\n    params={"kind": "vpc"}\n    r = urlreq(vpc_url, url_method, auth="BASIC", user=user, passwd=password, params=json.dumps(params), verify=False, headers=headers)\n  #  print "status code: {}".format(r.status_code)\n   # print "response: {}".format(r.text)\n    vpc_list_json = r.json()\n    for vpc in vpc_list_json["entities"]:\n      if vpc["spec"]["name"]==vpc_name:\n        return vpc["metadata"]["uuid"]\n    exit(1)\nvpc_uuid=get_vpc_uuid("@@{vpc_name}@@")\n\npayload = {\n  "kind": "subnet"\n\n}\nbase_url = "https://" + ip + ":9440/api/nutanix/v3/subnets"\nurl = base_url + "/list"\nr = urlreq(url, url_method, auth="BASIC", user=user, passwd=password, params=json.dumps(payload), verify=False, headers=headers)\n#print "Status code: {}".format(r.status_code)\n#print "Output: {}".format(r.text)\nsubnet_list = []\nsubnet_list_json = r.json()\nfor subnet in subnet_list_json[\'entities\']:\n # print "cluster[\'spec\'][\'name\']"\n  if subnet[\'spec\'][\'resources\'][\'subnet_type\'] == \'OVERLAY\' and subnet[\'spec\'][\'resources\'][\'vpc_reference\'][\'uuid\'] == vpc_uuid:\n    subnet_list.append("{}".format(subnet[\'spec\'][\'name\']))\n\nprint \',\'.join(subnet_list)\n'})}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["On the left hand side of the screen, create a service action:\n",(0,r.jsx)(e.strong,{children:"Create Tunnel VM"})]}),"\n"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(670).A+"",width:"551",height:"293"})}),"\n"]}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["On the service, click ",(0,r.jsx)(e.strong,{children:"Create Task"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["Task Name: ",(0,r.jsx)(e.strong,{children:"Get VPC UUID"})]}),"\n",(0,r.jsxs)(e.li,{children:["Type: ",(0,r.jsx)(e.strong,{children:"Set Variable"})]}),"\n",(0,r.jsxs)(e.li,{children:["Script Type: ",(0,r.jsx)(e.strong,{children:"EScript"})]}),"\n",(0,r.jsxs)(e.li,{children:["output: ",(0,r.jsx)(e.strong,{children:"vpc_uuid"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'user = "@@{PC Credential.username}@@"\npassword = "@@{PC Credential.secret}@@"\nip = "@@{PC_IP}@@"\nheaders = {\'Accept\': \'application/json\', \'Content-Type\': \'application/json\'}\nurl_method = "POST"\n\ndef get_vpc_uuid(vpc_name):\n    vpc_url = "https://"+ip+":9440/api/nutanix/v3/vpcs/list"\n    params={"kind": "vpc"}\n    r = urlreq(vpc_url, url_method, auth="BASIC", user=user, passwd=password, params=json.dumps(params), verify=False, headers=headers)\n  #  print "status code: {}".format(r.status_code)\n   # print "response: {}".format(r.text)\n    vpc_list_json = r.json()\n    for vpc in vpc_list_json["entities"]:\n      if vpc["spec"]["name"]==vpc_name:\n        return vpc["metadata"]["uuid"]\n    exit(1)\nvpc_uuid=get_vpc_uuid("@@{vpc_name}@@")\nprint "vpc_uuid={0}".format(vpc_uuid)\n'})}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["On the service, click ",(0,r.jsx)(e.strong,{children:"Create Task"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["Task Name: ",(0,r.jsx)(e.strong,{children:"GetAccountName"})]}),"\n",(0,r.jsxs)(e.li,{children:["Type: ",(0,r.jsx)(e.strong,{children:"Set Variable"})]}),"\n",(0,r.jsxs)(e.li,{children:["Script Type: ",(0,r.jsx)(e.strong,{children:"EScript"})]}),"\n",(0,r.jsxs)(e.li,{children:["output: ",(0,r.jsx)(e.strong,{children:"account_name"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'print "account_name=NTNX_LOCAL_AZ"\n'})}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["On the service, click ",(0,r.jsx)(e.strong,{children:"Create Task"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["Task Name: ",(0,r.jsx)(e.strong,{children:"GetAccountUUID"})]}),"\n",(0,r.jsxs)(e.li,{children:["Type: ",(0,r.jsx)(e.strong,{children:"Set Variable"})]}),"\n",(0,r.jsxs)(e.li,{children:["Script Type: ",(0,r.jsx)(e.strong,{children:"EScript"})]}),"\n",(0,r.jsxs)(e.li,{children:["output: ",(0,r.jsx)(e.strong,{children:"account_uuid"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'user = "@@{PC Credential.username}@@"\npassword = "@@{PC Credential.secret}@@"\nip = "@@{PC_IP}@@"\npayload = {\n  "length": 250\n}\nbase_url = "https://" + ip + ":9440/api/nutanix/v3/accounts"\nurl = base_url + "/list"\nheaders = {\'Accept\': \'application/json\', \'Content-Type\': \'application/json\'}\nurl_method = "POST"\nr = urlreq(url, url_method, auth="BASIC", user=user, passwd=password, params=json.dumps(payload), verify=False, headers=headers)\naccount_list = []\naccount_list_json = r.json()\nfor account in account_list_json[\'entities\']:\n  if account[\'status\'][\'name\'] == "@@{account_name}@@": #sometimes this value will be \'{}\'\n    print "account_UUID={}".format(account[\'metadata\'][\'uuid\'])\n'})}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["On the service, click ",(0,r.jsx)(e.strong,{children:"Create Task"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["Task Name: ",(0,r.jsx)(e.strong,{children:"GetSubnetUUID"})]}),"\n",(0,r.jsxs)(e.li,{children:["Type: ",(0,r.jsx)(e.strong,{children:"Set Variable"})]}),"\n",(0,r.jsxs)(e.li,{children:["Script Type: ",(0,r.jsx)(e.strong,{children:"EScript"})]}),"\n",(0,r.jsxs)(e.li,{children:["output: ",(0,r.jsx)(e.strong,{children:"subnet_uuid"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'user = "@@{PC Credential.username}@@"\npassword = "@@{PC Credential.secret}@@"\nip = "@@{PC_IP}@@"\n\npayload = {\n\n}\n\nbase_url = "https://" + ip + ":9440/api/nutanix/v3/subnets"\nurl = base_url + "/list"\nheaders = {\'Accept\': \'application/json\', \'Content-Type\': \'application/json\'}\nurl_method = "POST"\nr = urlreq(url, url_method, auth="BASIC", user=user, passwd=password, params=json.dumps(payload), verify=False, headers=headers)\nsubnet_list = []\nsubnet_list_json = r.json()\nfor subnet in subnet_list_json[\'entities\']:\n  if subnet[\'spec\'][\'name\'] == "@@{subnet_name}@@":\n    print "pe_network_UUID={}".format(subnet[\'metadata\'][\'uuid\'])\n    exit(0)\n\nexit(1)\n'})}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["On the service, click ",(0,r.jsx)(e.strong,{children:"Create Task"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["Task Name: ",(0,r.jsx)(e.strong,{children:"GetClusterUUID"})]}),"\n",(0,r.jsxs)(e.li,{children:["Type: ",(0,r.jsx)(e.strong,{children:"Set Variable"})]}),"\n",(0,r.jsxs)(e.li,{children:["Script Type: ",(0,r.jsx)(e.strong,{children:"EScript"})]}),"\n",(0,r.jsxs)(e.li,{children:["output: ",(0,r.jsx)(e.strong,{children:"pe_cluster_uuid"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'user = "@@{PE Credential.username}@@" \npassword = "@@{PE Credential.secret}@@"\nip = "@@{PE_IP}@@"\n\ndef process_request(url, method, user, password, headers, payload=None):\n  r = urlreq(url, verb=method, auth="BASIC", user=user, passwd=password, params=payload, verify=False, headers=headers)\n  return r\npayload = {}\nbase_url = "https://" + ip + ":9440/PrismGateway/services/rest/v2.0/cluster"\nurl = base_url + "/"\nheaders = {\'Accept\': \'application/json\', \'Content-Type\': \'application/json\'}\nurl_method = "GET"\n\nr = process_request(url, url_method, user, password, headers, json.dumps(payload))\n\ncluster_list = []\ncluster_list_json = r.json()\n\nprint "pe_cluster_uuid={}".format(cluster_list_json[\'uuid\'])\n'})}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["On the service, click ",(0,r.jsx)(e.strong,{children:"Create Task"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["Task Name: ",(0,r.jsx)(e.strong,{children:"Provision Tunnel VM"})]}),"\n",(0,r.jsxs)(e.li,{children:["Type: ",(0,r.jsx)(e.strong,{children:"Execute"})]}),"\n",(0,r.jsxs)(e.li,{children:["Script Type: ",(0,r.jsx)(e.strong,{children:"EScript"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'user = "@@{PC Credential.username}@@"\npassword = "@@{PC Credential.secret}@@"\nip = "@@{PC_IP}@@"\n\nheaders = {\'Accept\': \'application/json\', \'Content-Type\': \'application/json\'}\nurl_method = "POST"\n\nnetwork_group_tunnel_uuid = "{}".format(str(uuid.uuid4()))\ntunnel_uuid = "{}".format(str(uuid.uuid4()))\n\npayload = {\n  "api_version": "3.1.0",\n  "metadata": {\n    "kind": "network_group_tunnel",\n    "uuid": network_group_tunnel_uuid\n  },\n  "spec": {\n    "resources": {\n      "platform_vpc_uuid_list": [\n        "@@{vpc_uuid}@@"\n      ],\n      "tunnel_reference": {\n        "kind": "tunnel",\n        "uuid": tunnel_uuid,\n        "name": "NTNX_LOCAL_AZ_VPC_@@{vpc_name}@@_Tunnel"\n      },\n      "account_reference": {\n        "kind": "account",\n        "name": "@@{account_name}@@",\n        "uuid": "@@{account_UUID}@@"\n      },\n      "tunnel_vm_spec": {\n        "vm_name": "@@{vpc_name}@@_@@{subnet_name}@@_TunnelVM",\n        "subnet_uuid": "@@{pe_network_UUID}@@",\n        "cluster_uuid": "@@{pe_cluster_uuid}@@"\n      }\n    },\n    "name": "VPC_@@{vpc_name}@@_NTNX_LOCAL_AZ"\n  }\n}\n\nbase_url = "https://" + ip + ":9440/api/nutanix/v3/network_groups/tunnels"\nurl = base_url\nr = urlreq(url, url_method, auth="BASIC", user=user, passwd=password, params=json.dumps(payload), verify=False, headers=headers)\nprint "Status code: {}".format(r.status_code)\nprint "Output: {}".format(r.text)\nif r.ok:\n  print "Successful invocation of tunnel VM"\nelse:\n  exit(1)\n'})}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["On the left side of the screen, click on ",(0,r.jsx)(e.strong,{children:"Package: Install"})]}),"\n"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(9061).A+"",width:"1026",height:"272"})}),"\n"]}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["Click on ",(0,r.jsx)(e.strong,{children:"+ Action"}),". Associate it with ",(0,r.jsx)(e.strong,{children:"Create Tunnel VM"})]}),"\n",(0,r.jsxs)(e.li,{children:["Let's create the service action to delete the tunnel vm. On the\nleft hand side of the screen, create a service action: ",(0,r.jsx)(e.strong,{children:"Delete\nTunnel VM"})]}),"\n"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(670).A+"",width:"551",height:"293"})}),"\n"]}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["On the service, click ",(0,r.jsx)(e.strong,{children:"Create Task"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["Task Name: ",(0,r.jsx)(e.strong,{children:"GetTunnelUUID"})]}),"\n",(0,r.jsxs)(e.li,{children:["Type: ",(0,r.jsx)(e.strong,{children:"Set Variable"})]}),"\n",(0,r.jsxs)(e.li,{children:["Script Type: ",(0,r.jsx)(e.strong,{children:"EScript"})]}),"\n",(0,r.jsxs)(e.li,{children:["output: ",(0,r.jsx)(e.strong,{children:"tunnel_uuid"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'user = "@@{PC Credential.username}@@"\npassword = "@@{PC Credential.secret}@@"\nip = "@@{PC_IP}@@"\n\nheaders = {\'Accept\': \'application/json\', \'Content-Type\': \'application/json\'}\nurl_method = "POST"\n\npayload = {\n  "kind": "tunnel",\n  "filter": "name==NTNX_LOCAL_AZ_VPC_@@{vpc_name}@@_Tunnel"\n}\n\nbase_url = "https://" + ip + ":9440/api/nutanix/v3/tunnels/list"\nurl = base_url\nr = urlreq(url, url_method, auth="BASIC", user=user, passwd=password, params=json.dumps(payload), verify=False, headers=headers)\nprint "Status code: {}".format(r.status_code)\nprint "Output: {}".format(r.text)\nif r.ok:\n  print "Successful retrieval of tunnel VM"\n  tunnel_json = r.json()\n  for tunnel in tunnel_json[\'entities\']:\n    if tunnel[\'metadata\'][\'name\'] == \'NTNX_LOCAL_AZ_VPC_@@{vpc_name}@@_Tunnel\':\n      print "tunnel_uuid={}".format(tunnel[\'metadata\'][\'uuid\'])\n      exit(0)\nelse:\n  exit(1)\n'})}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["On the service, click ",(0,r.jsx)(e.strong,{children:"Create Task"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["Task Name: ",(0,r.jsx)(e.strong,{children:"DeleteTunnel"})]}),"\n",(0,r.jsxs)(e.li,{children:["Type: ",(0,r.jsx)(e.strong,{children:"Execute"})]}),"\n",(0,r.jsxs)(e.li,{children:["Script Type: ",(0,r.jsx)(e.strong,{children:"EScript"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'user = "@@{PC Credential.username}@@"\npassword = "@@{PC Credential.secret}@@"\nip = "@@{PC_IP}@@"\n\nheaders = {\'Accept\': \'application/json\', \'Content-Type\': \'application/json\'}\nurl_method = "DELETE"\n\npayload = {\n}  \n\nbase_url = "https://" + ip + ":9440/api/nutanix/v3/tunnels/@@{tunnel_uuid}@@"\nurl = base_url\nr = urlreq(url, url_method, auth="BASIC", user=user, passwd=password, params=json.dumps(payload), verify=False, headers=headers)\nprint "Status code: {}".format(r.status_code)\nprint "Output: {}".format(r.text)\nif r.ok:\n  print "Successful deletion of tunnel VM"\nelse:\n  exit(1)\n'})}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["Associate the ",(0,r.jsx)(e.strong,{children:"Delete Tunnel VM"})," action with the ",(0,r.jsx)(e.strong,{children:"Package\nuninstall"})," action. Click on ",(0,r.jsx)(e.strong,{children:"+ Action"}),". Choose the ",(0,r.jsx)(e.strong,{children:"Delete\nTunnel VM"})," action."]}),"\n"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:'Enter the name of Application "TunnelVM-<INITIALS> and fill out\nthe form with the requested information'}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(7467).A+"",width:"903",height:"436"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["Press ",(0,r.jsx)(e.strong,{children:"Deploy"})]}),"\n",(0,r.jsx)(e.li,{children:'Once the application is "running". Let\'s look at the audit log.'}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(8449).A+"",width:"719",height:"582"})}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["In Calm ",(0,r.jsx)(e.strong,{children:"Accounts"}),", let's look at the tunnel VM during\nprovisioning"]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(2992).A+"",width:"903",height:"311"})}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["In Prism Central, ",(0,r.jsx)(e.strong,{children:"Compute & Storage"}),". Click on ",(0,r.jsx)(e.strong,{children:"VMs"})]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(1435).A+"",width:"903",height:"569"})})]})}function h(n={}){const{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(o,{...n})}):o(n)}},2440:(n,e,s)=>{s.d(e,{A:()=>r});const r=s.p+"assets/images/AddTaskToAction-3799cb33ab8e9a58f8f05f6d42d261a9.png"},670:(n,e,s)=>{s.d(e,{A:()=>r});const r=s.p+"assets/images/Create-Service-Action-9f5f90c943e43a62344c45d4c16b5b6e.png"},832:(n,e,s)=>{s.d(e,{A:()=>r});const r=s.p+"assets/images/Delete-VPC-fab263165be09af190654f1d7e47058d.png"},2881:(n,e,s)=>{s.d(e,{A:()=>r});const r=s.p+"assets/images/LaunchVPC-4cd60808217f32d3bbccfe4af18e5c40.png"},6318:(n,e,s)=>{s.d(e,{A:()=>r});const r=s.p+"assets/images/Subnet-Launch-304ca766409e0597b176032afdfcac2c.png"},3697:(n,e,s)=>{s.d(e,{A:()=>r});const r=s.p+"assets/images/audit-log-subnet-c749d7391d2643922d5db0ada0db47e1.png"},6413:(n,e,s)=>{s.d(e,{A:()=>r});const r=s.p+"assets/images/create-blueprint-b3ac2b8be639e2fd04d7a9b22441a163.png"},9061:(n,e,s)=>{s.d(e,{A:()=>r});const r=s.p+"assets/images/package-install-8c397a6148ef175dc4e690a60aac2508.png"},5769:(n,e,s)=>{s.d(e,{A:()=>r});const r=s.p+"assets/images/pc_cred-1fd5d1804d4cc22b0215a0a89ee39cbf.png"},172:(n,e,s)=>{s.d(e,{A:()=>r});const r=s.p+"assets/images/subnet-variables-3409bfcfb3243961c9a2d10feb23be55.png"},5587:(n,e,s)=>{s.d(e,{A:()=>r});const r=s.p+"assets/images/subnet-e88cfebbf6200b9072160719228b8853.png"},7507:(n,e,s)=>{s.d(e,{A:()=>r});const r=s.p+"assets/images/successful-vpc-d345b554dbd7ab3f5e36939a684f13c3.png"},8449:(n,e,s)=>{s.d(e,{A:()=>r});const r=s.p+"assets/images/tunnel-vm-audit-12f4742289ad875ffe9598c8aed6c0da.png"},2992:(n,e,s)=>{s.d(e,{A:()=>r});const r=s.p+"assets/images/tunnel-vm-created-0809111c1b2b6be7243e8be7213ae98c.png"},7467:(n,e,s)=>{s.d(e,{A:()=>r});const r=s.p+"assets/images/tunnel-vm-launch-37a5e64eb66edd967281e7cc13648312.png"},4035:(n,e,s)=>{s.d(e,{A:()=>r});const r=s.p+"assets/images/tunnel-vm-variables-9c6c7088323e67d0ddbff528861ceab5.png"},1435:(n,e,s)=>{s.d(e,{A:()=>r});const r=s.p+"assets/images/tunnel-vm-c12622d7f795707bbaa3c9157abc5dbe.png"},6212:(n,e,s)=>{s.d(e,{A:()=>r});const r=s.p+"assets/images/variables-cc67dc17faacfbef33aaea5cbc0275d1.png"},2701:(n,e,s)=>{s.d(e,{A:()=>r});const r=s.p+"assets/images/vpc-audit-log-807cb5513e3a69d02e03778176e3c4a5.png"},9706:(n,e,s)=>{s.d(e,{A:()=>r});const r=s.p+"assets/images/vpc-detail-b65496cdac60ea816345e54620e0f0f3.png"},5664:(n,e,s)=>{s.d(e,{A:()=>r});const r=s.p+"assets/images/vpc-overview-cf5d3284e273097b1d8828257ceccb95.png"},7634:(n,e,s)=>{s.d(e,{A:()=>r});const r=s.p+"assets/images/vpc-subnet-343c26c53beb287738f1c6ee4a4d24c7.png"},8453:(n,e,s)=>{s.d(e,{R:()=>l,x:()=>a});var r=s(6540);const t={},i=r.createContext(t);function l(n){const e=r.useContext(i);return r.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:l(n.components),r.createElement(i.Provider,{value:e},n.children)}}}]);